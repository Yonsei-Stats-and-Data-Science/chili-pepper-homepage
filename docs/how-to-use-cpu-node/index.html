<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>How to Use GPU Node for SLURM | Chili Pepper</title>
<meta name="keywords" content="" />
<meta name="description" content="How to use CPU node for SLURM Step 1 - terminal 앱 고르기 User는 SSH로 proxy node에 접속하여 클러스터를 사용합니다. 터미널 환경과 vi 에디터에 익숙한 user는 자신에게 친숙한 앱을 사용하면 됩니다. 그렇지 않은 경우, Visual Studio Code를 사용하는 것을 추천하며, 이 튜토리얼에서는 Visual Studio Code를 사용하는 것을 전제로 합니다. 추천 이유는 다음과 같습니다.
 Windows, MacOS, Linux에서 모두 사용 가능합니다. Web Version도 있기 때문에 모바일 디바이스에서도 사용할 수 있습니다. 또한 터미널과 에디터, 파일 브라우저가 통합되어 있기 때문에 불편하게 vi나 nano등의 CUI 기반 텍스트 에디터를 사용할 필요가 없으며, 파일 전송도 scp등의 복잡한 프로토콜을 사용할 필요 없이 drag &amp; drop으로 수행할 수 있습니다.">
<meta name="author" content="Jongmin Mun">
<link rel="canonical" href="https://hpc.stat.yonsei.ac.kr/docs/how-to-use-cpu-node/" />
<meta name="google-site-verification" content="XYZabc" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css" integrity="sha256-yIlj/i15RiAA/Q&#43;xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js" integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5&#43;kdJvBz5iKbt6B5PJI="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://hpc.stat.yonsei.ac.kr/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://hpc.stat.yonsei.ac.kr/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://hpc.stat.yonsei.ac.kr/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://hpc.stat.yonsei.ac.kr/apple-touch-icon.png">
<link rel="mask-icon" href="https://hpc.stat.yonsei.ac.kr/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.91.2" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="How to Use GPU Node for SLURM" />
<meta property="og:description" content="How to use CPU node for SLURM Step 1 - terminal 앱 고르기 User는 SSH로 proxy node에 접속하여 클러스터를 사용합니다. 터미널 환경과 vi 에디터에 익숙한 user는 자신에게 친숙한 앱을 사용하면 됩니다. 그렇지 않은 경우, Visual Studio Code를 사용하는 것을 추천하며, 이 튜토리얼에서는 Visual Studio Code를 사용하는 것을 전제로 합니다. 추천 이유는 다음과 같습니다.
 Windows, MacOS, Linux에서 모두 사용 가능합니다. Web Version도 있기 때문에 모바일 디바이스에서도 사용할 수 있습니다. 또한 터미널과 에디터, 파일 브라우저가 통합되어 있기 때문에 불편하게 vi나 nano등의 CUI 기반 텍스트 에디터를 사용할 필요가 없으며, 파일 전송도 scp등의 복잡한 프로토콜을 사용할 필요 없이 drag &amp; drop으로 수행할 수 있습니다." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hpc.stat.yonsei.ac.kr/docs/how-to-use-cpu-node/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2022-03-15T14:54:35&#43;09:00" />
<meta property="article:modified_time" content="2022-03-15T14:54:35&#43;09:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to Use GPU Node for SLURM"/>
<meta name="twitter:description" content="How to use CPU node for SLURM Step 1 - terminal 앱 고르기 User는 SSH로 proxy node에 접속하여 클러스터를 사용합니다. 터미널 환경과 vi 에디터에 익숙한 user는 자신에게 친숙한 앱을 사용하면 됩니다. 그렇지 않은 경우, Visual Studio Code를 사용하는 것을 추천하며, 이 튜토리얼에서는 Visual Studio Code를 사용하는 것을 전제로 합니다. 추천 이유는 다음과 같습니다.
 Windows, MacOS, Linux에서 모두 사용 가능합니다. Web Version도 있기 때문에 모바일 디바이스에서도 사용할 수 있습니다. 또한 터미널과 에디터, 파일 브라우저가 통합되어 있기 때문에 불편하게 vi나 nano등의 CUI 기반 텍스트 에디터를 사용할 필요가 없으며, 파일 전송도 scp등의 복잡한 프로토콜을 사용할 필요 없이 drag &amp; drop으로 수행할 수 있습니다."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Docs",
      "item": "https://hpc.stat.yonsei.ac.kr/docs/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "How to Use GPU Node for SLURM",
      "item": "https://hpc.stat.yonsei.ac.kr/docs/how-to-use-cpu-node/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "How to Use GPU Node for SLURM",
  "name": "How to Use GPU Node for SLURM",
  "description": "How to use CPU node for SLURM Step 1 - terminal 앱 고르기 User는 SSH로 proxy node에 접속하여 클러스터를 사용합니다. 터미널 환경과 vi 에디터에 익숙한 user는 자신에게 친숙한 앱을 사용하면 됩니다. 그렇지 않은 경우, Visual Studio Code를 사용하는 것을 추천하며, 이 튜토리얼에서는 Visual Studio Code를 사용하는 것을 전제로 합니다. 추천 이유는 다음과 같습니다.\n Windows, MacOS, Linux에서 모두 사용 가능합니다. Web Version도 있기 때문에 모바일 디바이스에서도 사용할 수 있습니다. 또한 터미널과 에디터, 파일 브라우저가 통합되어 있기 때문에 불편하게 vi나 nano등의 CUI 기반 텍스트 에디터를 사용할 필요가 없으며, 파일 전송도 scp등의 복잡한 프로토콜을 사용할 필요 없이 drag \u0026amp; drop으로 수행할 수 있습니다.",
  "keywords": [
    
  ],
  "articleBody": "How to use CPU node for SLURM Step 1 - terminal 앱 고르기 User는 SSH로 proxy node에 접속하여 클러스터를 사용합니다. 터미널 환경과 vi 에디터에 익숙한 user는 자신에게 친숙한 앱을 사용하면 됩니다. 그렇지 않은 경우, Visual Studio Code를 사용하는 것을 추천하며, 이 튜토리얼에서는 Visual Studio Code를 사용하는 것을 전제로 합니다. 추천 이유는 다음과 같습니다.\n Windows, MacOS, Linux에서 모두 사용 가능합니다. Web Version도 있기 때문에 모바일 디바이스에서도 사용할 수 있습니다. 또한 터미널과 에디터, 파일 브라우저가 통합되어 있기 때문에 불편하게 vi나 nano등의 CUI 기반 텍스트 에디터를 사용할 필요가 없으며, 파일 전송도 scp등의 복잡한 프로토콜을 사용할 필요 없이 drag \u0026 drop으로 수행할 수 있습니다.  터미널에서 ssh 접속만 할 수 있다면 어떤 기기에서도 proxy node에 접속하여 작업을 제출할 수 있으며, 터미널이 종료되어도 작업은 계속 실행됩니다. Standard output(Python, R에서 console에 출력되는 메시지)가 로그 파일에 기록되므로, 나중에 다시 터미널에 접속하여 job 실행 현황을 확인할 수 있습니다.\nVisual Studio Code외에 다른 앱을 사용하실 경우 추천하는 앱은 다음과 같습니다.\n Windows 10: PowerShell보다는 Windows Terminal를 추천합니다. MacOS: 기본 터미널을 사용해도 되지만, iTerm2를 추천합니다. iOS: Blink Android: Termux  Step 2 - proxy node SSH 접속 1. Visual Studio Code extensions에서 Remote Development 설치fn^3 Microsoft가 제공하는 Remote Development extension pack을 설치합니다. Remote-WSL, Remote-Containers, Remote-SSH가 자동적으로 같이 설치됩니다. 2. Remote Explorer에서 SSH Targets를 선택 후, Add New 클릭 3. ssh 접속 커맨드 입력 아래와 같은 창이 뜨면 ssh 커맨드를 입력하여 proxy node에 접속합니다. 아래 코드에 Slack으로 안내받은 ip, port, username을 넣어서 위 창에 입력하고 Enter키를 누르면 됩니다. SSH의 default port는 22이지만, 저희의 클러스터는 보안상 이유로 다른 port를 사용합니다.\n1  ssh -p [port] [username]@[ip]   4. SSH configuration file을 저장할 장소 선택 Select SSH configuration file to update가 나오면 맨 위 항목을 선택합니다. Host added! 라는 메시지가 우측 하단에 나옵니다. 5. Remote Explore에서 Connect to Host in New Window 선택 6. 서버 Platform 선택 Linux를 선택합니다. 7. Password 입력 안내받은 password를 입력하여 로그인합니다. 8. 파일 시스템 마운트 좌측 탭의 파일 모양 아이콘을 클릭하고 Open Folder 버튼을 클릭합니다. 기본적으로 user home directory 경로가 입력되어 있습니다. OK를 누릅니다. 9. 둘러보기   좌측 file explorer에서 파일을 관리합니다. Windows 탐색기나 MacOS Finder에서 drag\u0026drop으로 파일을 옮길 수 있습니다. 클러스터 내부의 파일을 user의 local 컴퓨터로 가져오는 것도 drag\u0026drop으로 가능합니다.\n  ctrl + shift + ~키를 누르면 터미널이 열립니다. 여기서 서버 사용에 필요한 커맨드를 입력합니다.\n  text editor에서 코드와 스크립트를 수정하고 이미지 파일 등을 열람합니다.\n  Step 3 - 파일 시스템 구조 이해 NAS(Network Attached Storage)에 각 user의 home directory가 있습니다. NAS는 모든 node에 마운트되어 있으며, 모든 node에서 user명과 group명 및 관련 설정이 동일합니다. User명은 컴퓨팅 클러스터 사용 신청시 제출하신 이메일 주소의 @ 앞 부분과 동일합니다.\nUser home directory의 prefix는 /mnt/nas/users/입니다. 예를 들어, dummyuser라는 user의 home directory의 경로는 /mnt/nas/users/dummyuser/입니다. 다른 user의 home directory를 열람할 수 없도록 권한설정이 되어 있습니다. 각 user는 데이터와 코드, 설정 파일 등을 자신의 home directory 내에 저장합니다.\n Linux에서 directory를 이동하는 명령어는 cd입니다. home directory를 나타내는 기호는 ~입니다. 현재 directory를 확인하는 명령어는 pwd입니다 파일 목록을 확인하는 명령어는 ls입니다.  따라서 user는 proxy node아래의 명령어를 통해 자신의 홈 directory로 이동해 그 안에 있는 파일 목록을 확인할 수 있습니다.\n1 2  cd ~ ls   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  # with the tree command the home directory will typically look like this /mnt/nas/users/dummyuser/ ├── .bash_history ├── .bash_logout ├── .bashrc ├── .conda ├── .config ├── GettingStarted.md ├── .gnupg ├── .ipynb_checkpoints ├── .ipython ├── .jupyter ├── .local ├── logs ├── .npm ├── .profile ├── .python_history ├── some_script.sh ├── .ssh └── .viminfo   Step 3 - Data Transfer 파일을 옮길 때에는 크게 ‘SCP’와 ‘Git’ 두 가지 방법이 있습니다.\n방법 1. scp scp는 SSH와 같은 port를 사용합니다. 아래 커맨드를 이용해 파일을 보내고 받을 수 있습니다. dummyuser를 본인의 user명으로 바꾸고 파일명, directory명을 적절히 바꾸면 됩니다.\nSending a local file(some_file.txt) to the remote home directory 1  scp -P [port] some_file.txt dummyuser@hpc.stat.yonsei.ac.kr:~/   Sending a local directory(some_files/) to the remote home directory 1 2  scp -P [port] -r some_files dummyuser@hpc.stat.yonsei.ac.kr:~/ # /mnt/nas/users/dummyuser/some_files/ will be created   Recieving a remote file(some_file.txt) in the home directory to the current local directory 1  scp -P [port] dummyuser@hpc.stat.yonsei.ac.kr:~/some_file.txt   Recieving a remote directory(/mnt/nas/users/dummyuser/some_files) in the home directory to the current local directory 1  scp -P [port] -r dummyuser@hpc.stat.yonsei.ac.kr:~/some_files ./   이 외의 scp 옵션들은 여기서 확인할 수 있습니다.\n윈도우에서는 winscp 를 이용해 scp를 drag \u0026 drop으로 편리하게 이용할 수 있습니다.\nMacOS에서는 filezilla를 사용할 수 있습니다. 이에 대한 안내는 별도의 글로 작성되어 있습니다.\n방법 2. Git Git이 이미 설치되어 있으므로, 클러스터 내 적절한 directory에서 git clone을 사용합니다.\nStep 4. Conda environment 생성  cpu-compute node에는 conda version 4.11.0이 설치되어 있으며 Python version을 3.10까지 지원합니다fn^1. gpu-compute node에는 conda version 4.6.14가 설치되어 있으며 Python version을 3.8까지 지원합니다.  여기서는 cpu-compute node에서 conda environment를 생성하는 방법을 설명합니다. local에서 작성한 코드가 cpu-compute node에서 오류 없이 작동하도록 하기 위해, local과 cpu-compute node에서 동일한 conda environment를 구축해야 합니다.\n1. local에서 conda environment 생성 이 섹션의 작업은 모두 user의 local 컴퓨터에서 진행합니다.\nminiconda를 설치한 다음, local 컴퓨터의 터미널에서 아래 커맨드로 virtual environment를 설정합니다. testEnv 자리에 원하는 이름을 넣고, python= 뒤에 사용할 Python version을 명시합니다.\n1  conda create -n testEnv python=3.6   성공적으로 생성되면 아래와 같은 결과가 나옵니다.\n1 2 3 4 5 6 7 8 9 10 11  Preparing transaction: done Verifying transaction: done Executing transaction: done # # To activate this environment, use # # $ conda activate testEnv # # To deactivate an active environment, use # # $ conda deactivate   아래 커맨드를 통해 virtual environment가 제대로 생성되었는지 확인합니다.\n1  conda info --env   1 2 3 4  # conda environments: # base * /opt/miniconda3 testEnv /opt/miniconda3/envs/testEnv   Virtual environment에 진입한 뒤 패키지를 설치합니다. pip로 설치되는 패키지들은 conda로 설치된 패키지에 대한 정보를 모르기 때문에 의존성 충돌이 발생할 수 있으므로 conda만을 사용해서 설치하실 것을 권장합니다. anaconda 웹사이트에서 패키지명을 검색해서 linux-64를 지원하는 버전이 어디까지인지를 확인하고 설치하는 것을 추천합니다. 위 사이트는 설치 커맨드도 제공합니다. 여러 패키지를 설치할 경우 한 커맨드 내에 명시하면 conda가 자동으로 dependency 충돌을 검사해 줍니다.\n1 2 3 4  conda activate testEnv #For example, conda install -c conda-forge lightgbm==2.0.7 scikit-learn matplotlib keras   또는 user가 사용할 중요한 패키지들이 있을 경우 environment를 생성할 때 사용할 패키지 목록을 지정할 수도 있습니다. 아래 커맨드로 설치된 패키지 목록을 확인합니다.\n1  conda list   Environment를 지우려면 아래 커맨드를 입력합니다.\n1  conda remove --name testEnv --all   2. cpu-compute node에 local과 동일한 conda environment 구축하기 conda env export 커맨드를 이용해 environment 전체를 .yml 파일로 만들고 이를 이용해 cpu-compute 노드에서 environment를 구축하는 것이 동일한 environment를 만드는 가장 이상적인 방법입니다. 또는 설치된 패키지 목록과 버전만을 requirements.txt로 추출하여 노드에서 cpu-compute에서 설치할 수 있습니다. 그러나 이 두 방법은 user의 local 컴퓨터가 linux가 아니면 오류가 발생할 확률이 매우 높습니다. 이는 유저가 패키지를 설치할 때 자동으로 설치되는 dependency들의 버전이 OS별로 다를 수 있기 때문입니다. 예를 들어 lightgbm 2.0.7버전은 Python 버전이 3.6일 때 linux와 MacOS에서 둘 다 설치 가능하지만, 이 패키지의 dependency 중 하나인 libgfortran은 MacOS에서는 4.0.0버전이 설치되지만 linux에서는 3.0.0버전까지만 지원되기 때문에 MacOS에서 만든 environment에서 추출한 yml 파일이나 list txt 파일을 클러스터에서 사용하면 오류가 발생합니다[^fn2]. 이 오류는 적절한 조치를 통해 해결할 수 있을 때도 있지만 해결하기 힘들 때도 있습니다.\n따라서 local에서 만든 environment를 cluster로 옮기기보다는, local의 environment에서 사용하는 Python 버전과 중요 패키지들의 버전을 그대로 사용하여 cluster 내에서 environment를 생성하는 것을 추천하며, 이 문서에서는 그 절차를 안내합니다.\n  Conda environment 생성 batch script를 작성합니다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  #!/bin/bash #SBATCH --job-name=conda-env-create #SBATCH --nodes=1 #SBATCH --mem=4gb #SBATCH --partition=all #SBATCH --nodelist=cpu-compute #SBATCH --output=testEnv.out #SBATCH --error=testEnv.err CONDA_BIN_PATH=/opt/miniconda/bin ENV_NAME=testEnv #local에서와 같은 이름으로 입력 ENV_PATH=/mnt/nas/users/$(whoami)/.conda/envs/$ENV_NAME $CONDA_BIN_PATH/conda env remove --prefix $ENV_PATH $CONDA_BIN_PATH/conda create -y --prefix $ENV_PATH python=3.6 source $CONDA_BIN_PATH/activate $ENV_PATH conda install -c conda-forge lightgbm==2.0.7 scikit-learn matplotlib keras pandas numpy   위 내용에서\n 7번 라인의 #SBATCH –output=testEnv.out의 output log 파일명 8번 라인의 #SBATCH –error=testEnv.err의 error log 파일명 10번 라인의 environment name 13번 라인의 python version 14번 라인의 패키지 설치 커맨드 를 알맞게 수정한 뒤 local에서 testEnv.sh로 저장하여 scp로 클러스터 내 user home directory로 전송합니다. 또는 proxy node에 접속한 뒤 home directory에서  1  vi testEnv.sh   를 입력하여 linux의 텍스트 에디터를 실행한 뒤 ctrl+v로 위 내용을 붙여넣기하고 esc, :wq, ENTER를 차례로 눌러 저장합니다.\n  작성한 스크립트 실행하기. proxy node에 SSH접속한 뒤 home directory에서\n1  sbatch testEnv.sh   를 입력해 slurm batch job submission을 수행합니다. 작업이 노드에서 성공적으로 실행되면\n1  Submitted batch job 401   와 같은 메시지가 뜨고 job 번호가 할당됩니다.\n1  squeue   커맨드를 통해 작업 실행 현황을 확인할 수 있습니다.\n1 2  JOBID PARTITION NAME USER ST TIME NODES NODELIST(REASON) 402 all conda-en mjm R 0:01 1 cpu-compute   또는 아래 커맨드를 통해 실시간으로 작업 실행 현황을 확인할 수 있습니다.\n1  smap -i 1   다음 커맨드를 통해 output log, error log파일의 내용을 확인할 수 있습니다.\n1  cat testEnv.err   error log 또는 output log는 다음 커맨드를 통해 실시간으로 확인할 수 있습니다.\n1  tail -f testEnv.out     Step 2. make env file and upload file to user’s workspace local에서 만들어진 env 파일을 서버로 옮길 때는 scp를 사용한다. 간단한 사용법은 아래와 같다.\n1 2 3 4 5 6 7  # scp 사용법 # File upload scp [FILEPATH] ghk@[IP address]:~/ # upload from local, ~/ means home directory # File download scp ghk@[IP address]:[FILEPATH] ./ # scp [server file path] [local save path] # directory 전체 다운, 업로드 할 때는 -r 옵션을 사용한다.   Windows 사용자라면 WinSCP 라는 이름의 프로그램을 사용하면 local과 서버 간 파일 전송을 보다 쉽게 처리할 수 있다.\n 💡 env file을 이용한 conda 환경 설정은 local과 서버 작업 환경을 동일하게 설정할 수 있는 신뢰할 수 있는 방법이다. 그러나 conda 환경 설정 과정이 너무 번거롭다면 requirements.txt를 만들어 패키지 버전만 관리해도 충돌을 방지할 수 있다.  1 2 3 4 5 6 7  conda install --force-reinstall -y -q -c conda-forge --file requirements.txt # --force-reinstall : Install the package even if it already exists. # -y : Yes, do not ask for confirmation. # -q : Quiet, do not display progress bar. # -c : Channels, additional channels to search for packages # conda-forge is recommended   Step 3. make SLRUM batch script and run code in server 앞선 단계에서 conda환경이 잘 만들어졌다면 해당 가상환경을 activate하여 코드를 돌리는 SLURM batch script를 작성할 수 있다. 사용자들의 이해를 돕기 위해 TensorFlow 공식 페이지에 게시된 초보자용 튜토리얼 코드를 SLURM을 통해 실행시키는 예제를 공유한다. 먼저, 튜토리얼 코드는 다음과 같다.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23  # tensor.py import tensorflow as tf mnist = tf.keras.datasets.mnist (x_train, y_train), (x_test, y_test) = mnist.load_data() x_train, x_test = x_train / 255.0, x_test / 255.0 model = tf.keras.models.Sequential([ tf.keras.layers.Flatten(input_shape=(28, 28)), tf.keras.layers.Dense(128, activation='relu'), tf.keras.layers.Dropout(0.2), tf.keras.layers.Dense(10, activation='softmax') ]) model.compile(optimizer='adam', loss='sparse_categorical_crossentropy', metrics=['accuracy']) model.fit(x_train, y_train, epochs=5) model.evaluate(x_test, y_test, verbose=2)   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24  #!/bin/bash # #SBATCH --job-name=gpu-tensor-test #SBATCH --mem=4gb #SBATCH --nodelist=gpu-compute #SBATCH --ntasks=1 #SBATCH --cpus-per-task=1 #SBATCH --gres=gpu:1 #SBATCH --time=00:20:00 #SBATCH --account=ghk #SBATCH --partition=all #SBATCH --output=/mnt/nas/users/ghk/code/gputest.log CONDA_BIN_PATH=/opt/miniconda/bin ENV_NAME=tensor ENV_PATH=/mnt/nas/users/$(whoami)/.conda/envs/$ENV_NAME ## $CONDA_BIN_PATH/conda env remove --prefix $ENV_PATH ## $CONDA_BIN_PATH/conda create -y --prefix $ENV_PATH python=3.8 tensorflow pandas numpy source $CONDA_BIN_PATH/activate $ENV_PATH ## pip uninstall keras ## pip install keras==2.6.0 python /mnt/nas/users/ghk/code/tensor.py    —job-name: 수행할 작업의 이름 —mem: memory limit —nodelist: 작업할 노드의 이름 —ntasks: 작업의 수 —cpus-per-task: 각 작업에서 사용할 cpu 코어의 수 —gres=gpu : 작업에서 사용할 gpu의 개수, gpu-compute 노드에는 총 2개의 gpu가 사용 가능하다. —time: 작업 제한시간 —account: 해당 작업을 수행하는 계정의 이름 —partition: group of nodes with specific characteristics —output: 코드 실행 결과 log  제시한 대로 python 파일과 batch script 파일이 잘 만들어졌다면 sbatch 명령어를 입력하여 계산을 실행할 수 있다.\n1 2  sbatch tensor.sh smap -i 1 # 작업 현황을 1초마다 갱신하여 보여준다. ctrl+c로 escape 할 수 있다.   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  ghk@proxy:~/code$ cat gputest.log 2022-03-15 14:27:34.877232: I tensorflow/core/platform/cpu_feature_guard.cc:142] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations: SSE4.1 SSE4.2 AVX AVX2 AVX512F FMA To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags. 2022-03-15 14:27:34.887611: I tensorflow/core/common_runtime/process_util.cc:146] Creating new thread pool with default inter op setting: 2. Tune using inter_op_parallelism_threads for best performance. 2022-03-15 14:27:38.063857: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:185] None of the MLIR Optimization Passes are enabled (registered 2) Epoch 1/5 1875/1875 [==============================] - 36s 19ms/step - loss: 0.2993 - accuracy: 0.9140 Epoch 2/5 1875/1875 [==============================] - 18s 10ms/step - loss: 0.1436 - accuracy: 0.9575 Epoch 3/5 1875/1875 [==============================] - 17s 9ms/step - loss: 0.1080 - accuracy: 0.9675 Epoch 4/5 1875/1875 [==============================] - 19s 10ms/step - loss: 0.0866 - accuracy: 0.9739 Epoch 5/5 1875/1875 [==============================] - 52s 28ms/step - loss: 0.0750 - accuracy: 0.9762 313/313 - 4s - loss: 0.0782 - accuracy: 0.9779 [0.078231580555439, 0.9779000282287598]   SLURM batch script를 사용자들이 보다 편하게 만들 수 있도록 SLURM Job Configurator 를 새롭게 작성하였다. 사용자들은 gpu 옵션을 체크하거나 해제하여 gpu-compute node 사용 여부를 결정할 수 있다. 해당되는 옵션을 체크하고 Print 버튼을 누르면 손쉽게 batch script를 작성할 수 있다.\n더 알아보기 Submitting a slurm job script\nSLRUM Job Examples\nTensorFlow on the HPC Clusters\nRefernece ",
  "wordCount" : "2093",
  "inLanguage": "en",
  "datePublished": "2022-03-15T14:54:35+09:00",
  "dateModified": "2022-03-15T14:54:35+09:00",
  "author":{
    "@type": "Person",
    "name": "Jongmin Mun"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://hpc.stat.yonsei.ac.kr/docs/how-to-use-cpu-node/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Chili Pepper",
    "logo": {
      "@type": "ImageObject",
      "url": "https://hpc.stat.yonsei.ac.kr/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://hpc.stat.yonsei.ac.kr" accesskey="h" title="Chili Pepper (Alt + H)">Chili Pepper</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://hpc.stat.yonsei.ac.kr/docs/" title="Docs">
                    <span>Docs</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://hpc.stat.yonsei.ac.kr">Home</a>&nbsp;»&nbsp;<a href="https://hpc.stat.yonsei.ac.kr/docs/">Docs</a></div>
    <h1 class="post-title">
      How to Use GPU Node for SLURM
    </h1>
    <div class="post-meta"><span title='2022-03-15 14:54:35 +0900 +0900'>March 15, 2022</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;Jongmin Mun

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#how-to-use-cpu-node-for-slurm" aria-label="How to use CPU node for SLURM">How to use CPU node for SLURM</a><ul>
                        
                <li>
                    <a href="#step-1---terminal-%ec%95%b1-%ea%b3%a0%eb%a5%b4%ea%b8%b0" aria-label="Step 1 - terminal 앱 고르기">Step 1 - terminal 앱 고르기</a></li>
                <li>
                    <a href="#step-2---proxy-node-ssh-%ec%a0%91%ec%86%8d" aria-label="Step 2 - proxy node SSH 접속">Step 2 - proxy node SSH 접속</a><ul>
                        
                <li>
                    <a href="#1-visual-studio-code-extensions%ec%97%90%ec%84%9c-remote-development-%ec%84%a4%ec%b9%98fn3" aria-label="1. Visual Studio Code extensions에서 Remote Development 설치fn^3">1. Visual Studio Code extensions에서 Remote Development 설치<a href="https://jstar0525.tistory.com/14">fn^3</a></a></li>
                <li>
                    <a href="#2-remote-explorer%ec%97%90%ec%84%9c-ssh-targets%eb%a5%bc-%ec%84%a0%ed%83%9d-%ed%9b%84-add-new-%ed%81%b4%eb%a6%ad" aria-label="2. Remote Explorer에서 SSH Targets를 선택 후, Add New 클릭">2. Remote Explorer에서 SSH Targets를 선택 후, Add New 클릭</a></li>
                <li>
                    <a href="#3-ssh-%ec%a0%91%ec%86%8d-%ec%bb%a4%eb%a7%a8%eb%93%9c-%ec%9e%85%eb%a0%a5" aria-label="3. ssh 접속 커맨드 입력">3. ssh 접속 커맨드 입력</a></li>
                <li>
                    <a href="#4-ssh-configuration-file%ec%9d%84-%ec%a0%80%ec%9e%a5%ed%95%a0-%ec%9e%a5%ec%86%8c-%ec%84%a0%ed%83%9d" aria-label="4. SSH configuration file을 저장할 장소 선택">4. SSH configuration file을 저장할 장소 선택</a></li>
                <li>
                    <a href="#5-remote-explore%ec%97%90%ec%84%9c-connect-to-host-in-new-window-%ec%84%a0%ed%83%9d" aria-label="5. Remote Explore에서 Connect to Host in New Window 선택">5. Remote Explore에서 Connect to Host in New Window 선택</a></li>
                <li>
                    <a href="#6-%ec%84%9c%eb%b2%84-platform-%ec%84%a0%ed%83%9d" aria-label="6. 서버 Platform 선택">6. 서버 Platform 선택</a></li>
                <li>
                    <a href="#7-password-%ec%9e%85%eb%a0%a5" aria-label="7. Password 입력">7. Password 입력</a></li>
                <li>
                    <a href="#8-%ed%8c%8c%ec%9d%bc-%ec%8b%9c%ec%8a%a4%ed%85%9c-%eb%a7%88%ec%9a%b4%ed%8a%b8" aria-label="8. 파일 시스템 마운트">8. 파일 시스템 마운트</a></li>
                <li>
                    <a href="#9-%eb%91%98%eb%9f%ac%eb%b3%b4%ea%b8%b0" aria-label="9. 둘러보기">9. 둘러보기</a></li></ul>
                </li>
                <li>
                    <a href="#step-3---%ed%8c%8c%ec%9d%bc-%ec%8b%9c%ec%8a%a4%ed%85%9c-%ea%b5%ac%ec%a1%b0-%ec%9d%b4%ed%95%b4" aria-label="Step 3 - 파일 시스템 구조 이해">Step 3 - 파일 시스템 구조 이해</a></li>
                <li>
                    <a href="#step-3---data-transfer" aria-label="Step 3 - Data Transfer">Step 3 - Data Transfer</a><ul>
                        
                <li>
                    <a href="#%eb%b0%a9%eb%b2%95-1-scp" aria-label="방법 1. scp">방법 1. scp</a></li>
                <li>
                    <a href="#sending-a-local-filesome_filetxt-to-the-remote-home-directory" aria-label="Sending a local file(some_file.txt) to the remote home directory">Sending a local file(<code>some_file.txt</code>) to the remote home directory</a></li>
                <li>
                    <a href="#sending-a-local-directorysome_files-to-the-remote-home-directory" aria-label="Sending a local directory(some_files/) to the remote home directory">Sending a local directory(<code>some_files/</code>) to the remote home directory</a></li>
                <li>
                    <a href="#recieving-a-remote-filesome_filetxt-in-the-home-directory-to-the-current-local-directory" aria-label="Recieving a remote file(some_file.txt) in the home directory to the current local directory">Recieving a remote file(<code>some_file.txt</code>) in the home directory to the current local directory</a></li>
                <li>
                    <a href="#recieving-a-remote-directorymntnasusersdummyusersome_files-in-the-home-directory-to-the-current-local-directory" aria-label="Recieving a remote directory(/mnt/nas/users/dummyuser/some_files) in the home directory to the current local directory">Recieving a remote directory(<code>/mnt/nas/users/dummyuser/some_files</code>) in the home directory to the current local directory</a></li>
                <li>
                    <a href="#%eb%b0%a9%eb%b2%95-2-git" aria-label="방법 2. Git">방법 2. Git</a></li></ul>
                </li>
                <li>
                    <a href="#step-4-conda-environment-%ec%83%9d%ec%84%b1" aria-label="Step 4. Conda environment 생성">Step 4. Conda environment 생성</a><ul>
                        
                <li>
                    <a href="#1-local%ec%97%90%ec%84%9c-conda-environment-%ec%83%9d%ec%84%b1" aria-label="1. local에서 conda environment 생성">1. local에서 conda environment 생성</a></li>
                <li>
                    <a href="#2-cpu-compute-node%ec%97%90-local%ea%b3%bc-%eb%8f%99%ec%9d%bc%ed%95%9c-conda-environment-%ea%b5%ac%ec%b6%95%ed%95%98%ea%b8%b0" aria-label="2. cpu-compute node에 local과 동일한 conda environment 구축하기">2. <code>cpu-compute</code> node에 local과 동일한 conda environment 구축하기</a></li></ul>
                </li>
                <li>
                    <a href="#step-2-make-env-file-and-upload-file-to-users-workspace" aria-label="Step 2. make env file and upload file to user’s workspace">Step 2. make env file and upload file to user’s workspace</a></li>
                <li>
                    <a href="#step-3-make-slrum-batch-script-and-run-code-in-server" aria-label="Step 3. make SLRUM batch script and run code in server">Step 3. make SLRUM batch script and run code in server</a></li>
                <li>
                    <a href="#%eb%8d%94-%ec%95%8c%ec%95%84%eb%b3%b4%ea%b8%b0" aria-label="더 알아보기">더 알아보기</a></li></ul>
                </li>
                <li>
                    <a href="#refernece" aria-label="Refernece">Refernece</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="how-to-use-cpu-node-for-slurm">How to use CPU node for SLURM<a hidden class="anchor" aria-hidden="true" href="#how-to-use-cpu-node-for-slurm">#</a></h1>
<h2 id="step-1---terminal-앱-고르기">Step 1 - terminal 앱 고르기<a hidden class="anchor" aria-hidden="true" href="#step-1---terminal-앱-고르기">#</a></h2>
<p>User는 <code>SSH</code>로 <code>proxy</code> node에 접속하여 클러스터를 사용합니다. 터미널 환경과 <code>vi</code> 에디터에 익숙한 user는 자신에게 친숙한 앱을 사용하면 됩니다. 그렇지 않은 경우, <a href="https://code.visualstudio.com/download">Visual Studio Code</a>를 사용하는 것을 추천하며, 이 튜토리얼에서는 <code>Visual Studio Code</code>를 사용하는 것을 전제로 합니다. 추천 이유는 다음과 같습니다.</p>
<ul>
<li>Windows, MacOS, Linux에서 모두 사용 가능합니다.</li>
<li><a href="https://code.visualstudio.com/docs/editor/vscode-web">Web Version</a>도 있기 때문에 모바일 디바이스에서도 사용할 수 있습니다.</li>
<li>또한 터미널과 에디터, 파일 브라우저가 통합되어 있기 때문에 불편하게 <code>vi</code>나 <code>nano</code>등의 CUI 기반 텍스트 에디터를 사용할 필요가 없으며, 파일 전송도 <code>scp</code>등의 복잡한 프로토콜을 사용할 필요 없이 drag &amp; drop으로 수행할 수 있습니다.</li>
</ul>
<p>터미널에서 ssh 접속만 할 수 있다면 어떤 기기에서도 <code>proxy</code> node에 접속하여 작업을 제출할 수 있으며, 터미널이 종료되어도 작업은 계속 실행됩니다. Standard output(Python, R에서 console에 출력되는 메시지)가 로그 파일에 기록되므로, 나중에 다시 터미널에 접속하여 job 실행 현황을 확인할 수 있습니다.</p>
<p><code>Visual Studio Code</code>외에 다른 앱을 사용하실 경우 추천하는 앱은 다음과 같습니다.</p>
<ul>
<li>Windows 10: PowerShell보다는 <a href="(https://docs.microsoft.com/ko-kr/windows/terminal/install)">Windows Terminal</a>를 추천합니다.</li>
<li>MacOS: 기본 터미널을 사용해도 되지만, <a href="https://iterm2.com">iTerm2</a>를 추천합니다.</li>
<li>iOS: <a href="https://apps.apple.com/app/id1594898306">Blink</a></li>
<li>Android: <a href="https://play.google.com/store/apps/details?id=com.termux&amp;hl=ko&amp;gl=US">Termux</a></li>
</ul>
<h2 id="step-2---proxy-node-ssh-접속">Step 2 - proxy node SSH 접속<a hidden class="anchor" aria-hidden="true" href="#step-2---proxy-node-ssh-접속">#</a></h2>
<h3 id="1-visual-studio-code-extensions에서-remote-development-설치fn3">1. Visual Studio Code extensions에서 Remote Development 설치<a href="https://jstar0525.tistory.com/14">fn^3</a><a hidden class="anchor" aria-hidden="true" href="#1-visual-studio-code-extensions에서-remote-development-설치fn3">#</a></h3>
<p>Microsoft가 제공하는 <code>Remote Development</code> extension pack을 설치합니다. Remote-WSL, Remote-Containers, Remote-SSH가 자동적으로 같이 설치됩니다.
<img loading="lazy" src="/assets/vscode_ssh_1.png" alt="vscode_ssh_1"  />

<img loading="lazy" src="/assets/vscode_ssh_2.png" alt="vscode_ssh_2"  />
</p>
<h3 id="2-remote-explorer에서-ssh-targets를-선택-후-add-new-클릭">2. Remote Explorer에서 SSH Targets를 선택 후, Add New 클릭<a hidden class="anchor" aria-hidden="true" href="#2-remote-explorer에서-ssh-targets를-선택-후-add-new-클릭">#</a></h3>
<p><img loading="lazy" src="/assets/vscode_ssh_3.png" alt="vscode_ssh_3"  />
</p>
<h3 id="3-ssh-접속-커맨드-입력">3. ssh 접속 커맨드 입력<a hidden class="anchor" aria-hidden="true" href="#3-ssh-접속-커맨드-입력">#</a></h3>
<p>아래와 같은 창이 뜨면 ssh 커맨드를 입력하여 <code>proxy node</code>에 접속합니다.
<img loading="lazy" src="/assets/vscode_ssh_4.png" alt="vscode_ssh_4"  />
</p>
<p>아래 코드에 Slack으로 안내받은 ip, port, username을 넣어서 위 창에 입력하고 <code>Enter</code>키를 누르면 됩니다. <code>SSH</code>의 default port는 <code>22</code>이지만, 저희의 클러스터는 보안상 이유로 다른 port를 사용합니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ssh -p <span class="o">[</span>port<span class="o">]</span> <span class="o">[</span>username<span class="o">]</span>@<span class="o">[</span>ip<span class="o">]</span> 
</code></pre></td></tr></table>
</div>
</div><h3 id="4-ssh-configuration-file을-저장할-장소-선택">4. SSH configuration file을 저장할 장소 선택<a hidden class="anchor" aria-hidden="true" href="#4-ssh-configuration-file을-저장할-장소-선택">#</a></h3>
<p><strong>Select SSH configuration file to update</strong>가 나오면 맨 위 항목을 선택합니다.
<img loading="lazy" src="/assets/vscode_ssh_5.png" alt="vscode_ssh_5"  />
</p>
<p><strong>Host added!</strong> 라는 메시지가 우측 하단에 나옵니다.
<img loading="lazy" src="/assets/vscode_ssh_6.png" alt="vscode_ssh_6"  />
</p>
<h3 id="5-remote-explore에서-connect-to-host-in-new-window-선택">5. Remote Explore에서 Connect to Host in New Window 선택<a hidden class="anchor" aria-hidden="true" href="#5-remote-explore에서-connect-to-host-in-new-window-선택">#</a></h3>
<p><img loading="lazy" src="/assets/vscode_ssh_7.png" alt="vscode_ssh_7"  />
</p>
<h3 id="6-서버-platform-선택">6. 서버 Platform 선택<a hidden class="anchor" aria-hidden="true" href="#6-서버-platform-선택">#</a></h3>
<p>Linux를 선택합니다.
<img loading="lazy" src="/assets/vscode_ssh_8.png" alt="vscode_ssh_8"  />
</p>
<h3 id="7-password-입력">7. Password 입력<a hidden class="anchor" aria-hidden="true" href="#7-password-입력">#</a></h3>
<p>안내받은 password를 입력하여 로그인합니다.
<img loading="lazy" src="/assets/vscode_ssh_9.png" alt="vscode_ssh_9"  />
</p>
<h3 id="8-파일-시스템-마운트">8. 파일 시스템 마운트<a hidden class="anchor" aria-hidden="true" href="#8-파일-시스템-마운트">#</a></h3>
<p>좌측 탭의 파일 모양 아이콘을 클릭하고 <strong>Open Folder</strong> 버튼을 클릭합니다.
<img loading="lazy" src="/assets/vscode_ssh_10.png" alt="vscode_ssh_10"  />
</p>
<p>기본적으로 user home directory 경로가 입력되어 있습니다. OK를 누릅니다.
<img loading="lazy" src="/assets/vscode_ssh_11.png" alt="vscode_ssh_11"  />
</p>
<h3 id="9-둘러보기">9. 둘러보기<a hidden class="anchor" aria-hidden="true" href="#9-둘러보기">#</a></h3>
<p><img loading="lazy" src="/assets/vscode_ssh_12.png" alt="vscode_ssh_12"  />
</p>
<ul>
<li>
<p>좌측 file explorer에서 파일을 관리합니다. Windows 탐색기나 MacOS Finder에서 drag&amp;drop으로 파일을 옮길 수 있습니다. 클러스터 내부의 파일을 user의 local 컴퓨터로 가져오는 것도 drag&amp;drop으로 가능합니다.</p>
</li>
<li>
<p><code>ctrl + shift + ~</code>키를 누르면 터미널이 열립니다. 여기서 서버 사용에 필요한 커맨드를 입력합니다.</p>
</li>
<li>
<p>text editor에서 코드와 스크립트를 수정하고 이미지 파일 등을 열람합니다.</p>
</li>
</ul>
<h2 id="step-3---파일-시스템-구조-이해">Step 3 - 파일 시스템 구조 이해<a hidden class="anchor" aria-hidden="true" href="#step-3---파일-시스템-구조-이해">#</a></h2>
<p>NAS(Network Attached Storage)에 각 user의 home directory가 있습니다. NAS는 모든 node에 마운트되어 있으며, 모든 node에서 user명과 group명 및 관련 설정이 동일합니다. User명은 컴퓨팅 클러스터 사용 신청시 제출하신 이메일 주소의 @ 앞 부분과 동일합니다.</p>
<p>User home directory의 prefix는 <code>/mnt/nas/users/</code>입니다. 예를 들어, <code>dummyuser</code>라는 user의 home directory의 경로는 <code>/mnt/nas/users/dummyuser/</code>입니다. 다른 user의 home directory를 열람할 수 없도록 권한설정이 되어 있습니다. 각 user는 데이터와 코드, 설정 파일 등을 자신의 home directory 내에 저장합니다.</p>
<ul>
<li>Linux에서 directory를 이동하는 명령어는 <code>cd</code>입니다.</li>
<li>home directory를 나타내는 기호는 <code>~</code>입니다.</li>
<li>현재 directory를 확인하는 명령어는 <code>pwd</code>입니다</li>
<li>파일 목록을 확인하는 명령어는 <code>ls</code>입니다.</li>
</ul>
<p>따라서 user는 proxy node아래의 명령어를 통해 자신의 홈 directory로 이동해 그 안에 있는 파일 목록을 확인할 수 있습니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span><span class="lnt" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2">2</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">cd ~
ls
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1"> 1</a>
</span><span class="lnt" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2"> 2</a>
</span><span class="lnt" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3"> 3</a>
</span><span class="lnt" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4"> 4</a>
</span><span class="lnt" id="5"><a style="outline: none; text-decoration:none; color:inherit" href="#5"> 5</a>
</span><span class="lnt" id="6"><a style="outline: none; text-decoration:none; color:inherit" href="#6"> 6</a>
</span><span class="lnt" id="7"><a style="outline: none; text-decoration:none; color:inherit" href="#7"> 7</a>
</span><span class="lnt" id="8"><a style="outline: none; text-decoration:none; color:inherit" href="#8"> 8</a>
</span><span class="lnt" id="9"><a style="outline: none; text-decoration:none; color:inherit" href="#9"> 9</a>
</span><span class="lnt" id="10"><a style="outline: none; text-decoration:none; color:inherit" href="#10">10</a>
</span><span class="lnt" id="11"><a style="outline: none; text-decoration:none; color:inherit" href="#11">11</a>
</span><span class="lnt" id="12"><a style="outline: none; text-decoration:none; color:inherit" href="#12">12</a>
</span><span class="lnt" id="13"><a style="outline: none; text-decoration:none; color:inherit" href="#13">13</a>
</span><span class="lnt" id="14"><a style="outline: none; text-decoration:none; color:inherit" href="#14">14</a>
</span><span class="lnt" id="15"><a style="outline: none; text-decoration:none; color:inherit" href="#15">15</a>
</span><span class="lnt" id="16"><a style="outline: none; text-decoration:none; color:inherit" href="#16">16</a>
</span><span class="lnt" id="17"><a style="outline: none; text-decoration:none; color:inherit" href="#17">17</a>
</span><span class="lnt" id="18"><a style="outline: none; text-decoration:none; color:inherit" href="#18">18</a>
</span><span class="lnt" id="19"><a style="outline: none; text-decoration:none; color:inherit" href="#19">19</a>
</span><span class="lnt" id="20"><a style="outline: none; text-decoration:none; color:inherit" href="#20">20</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"># with the tree command the home directory will typically look like this
/mnt/nas/users/dummyuser/
├── .bash_history
├── .bash_logout
├── .bashrc
├── .conda
├── .config
├── GettingStarted.md
├── .gnupg
├── .ipynb_checkpoints
├── .ipython
├── .jupyter
├── .local
├── logs
├── .npm
├── .profile
├── .python_history
├── some_script.sh
├── .ssh
└── .viminfo
</code></pre></td></tr></table>
</div>
</div><h2 id="step-3---data-transfer">Step 3 - Data Transfer<a hidden class="anchor" aria-hidden="true" href="#step-3---data-transfer">#</a></h2>
<p>파일을 옮길 때에는 크게 &lsquo;SCP&rsquo;와 &lsquo;Git&rsquo; 두 가지 방법이 있습니다.</p>
<h3 id="방법-1-scp">방법 1. scp<a hidden class="anchor" aria-hidden="true" href="#방법-1-scp">#</a></h3>
<p><code>scp</code>는 <code>SSH</code>와 같은 port를 사용합니다. 아래 커맨드를 이용해 파일을 보내고 받을 수 있습니다. <code>dummyuser</code>를 본인의 user명으로 바꾸고 파일명, directory명을 적절히 바꾸면 됩니다.</p>
<h3 id="sending-a-local-filesome_filetxt-to-the-remote-home-directory">Sending a local file(<code>some_file.txt</code>) to the remote home directory<a hidden class="anchor" aria-hidden="true" href="#sending-a-local-filesome_filetxt-to-the-remote-home-directory">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">scp -P <span class="o">[</span>port<span class="o">]</span> some_file.txt dummyuser@hpc.stat.yonsei.ac.kr:~/
</code></pre></td></tr></table>
</div>
</div><h3 id="sending-a-local-directorysome_files-to-the-remote-home-directory">Sending a local directory(<code>some_files/</code>) to the remote home directory<a hidden class="anchor" aria-hidden="true" href="#sending-a-local-directorysome_files-to-the-remote-home-directory">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span><span class="lnt" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2">2</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">scp -P <span class="o">[</span>port<span class="o">]</span> -r some_files dummyuser@hpc.stat.yonsei.ac.kr:~/
<span class="c1"># /mnt/nas/users/dummyuser/some_files/ will be created</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="recieving-a-remote-filesome_filetxt-in-the-home-directory-to-the-current-local-directory">Recieving a remote file(<code>some_file.txt</code>) in the home directory to the current local directory<a hidden class="anchor" aria-hidden="true" href="#recieving-a-remote-filesome_filetxt-in-the-home-directory-to-the-current-local-directory">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">scp -P <span class="o">[</span>port<span class="o">]</span> dummyuser@hpc.stat.yonsei.ac.kr:~/some_file.txt
</code></pre></td></tr></table>
</div>
</div><h3 id="recieving-a-remote-directorymntnasusersdummyusersome_files-in-the-home-directory-to-the-current-local-directory">Recieving a remote directory(<code>/mnt/nas/users/dummyuser/some_files</code>) in the home directory to the current local directory<a hidden class="anchor" aria-hidden="true" href="#recieving-a-remote-directorymntnasusersdummyusersome_files-in-the-home-directory-to-the-current-local-directory">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">scp -P <span class="o">[</span>port<span class="o">]</span> -r dummyuser@hpc.stat.yonsei.ac.kr:~/some_files ./
</code></pre></td></tr></table>
</div>
</div><p>이 외의 scp 옵션들은 <a href="https://www.pcwdld.com/what-is-scp#wbounce-modal">여기서</a> 확인할 수 있습니다.</p>
<p>윈도우에서는 <a href="https://winscp.net/eng/download.php">winscp</a> 를 이용해 <code>scp</code>를 drag &amp; drop으로 편리하게 이용할 수 있습니다.</p>
<p>MacOS에서는 <a href="https://filezilla-project.org">filezilla</a>를 사용할 수 있습니다. 이에 대한 안내는 별도의 글로 작성되어 있습니다.</p>
<h3 id="방법-2-git">방법 2. Git<a hidden class="anchor" aria-hidden="true" href="#방법-2-git">#</a></h3>
<p><code>Git</code>이 이미 설치되어 있으므로, 클러스터 내 적절한 directory에서 <code>git clone</code>을 사용합니다.</p>
<h2 id="step-4-conda-environment-생성">Step 4. Conda environment 생성<a hidden class="anchor" aria-hidden="true" href="#step-4-conda-environment-생성">#</a></h2>
<ul>
<li><code>cpu-compute</code> node에는 conda version 4.11.0이 설치되어 있으며 Python version을 3.10까지 지원합니다<a href="https://docs.conda.io/projects/conda/en/latest/release-notes.html">fn^1</a>.</li>
<li><code>gpu-compute</code> node에는 conda version 4.6.14가 설치되어 있으며 Python version을 3.8까지 지원합니다.</li>
</ul>
<p>여기서는 <code>cpu-compute</code> node에서 conda environment를 생성하는 방법을 설명합니다. local에서 작성한 코드가 <code>cpu-compute</code> node에서 오류 없이 작동하도록 하기 위해, local과 <code>cpu-compute</code> node에서 동일한 conda environment를 구축해야 합니다.</p>
<h3 id="1-local에서-conda-environment-생성">1. local에서 conda environment 생성<a hidden class="anchor" aria-hidden="true" href="#1-local에서-conda-environment-생성">#</a></h3>
<p>이 섹션의 작업은 모두 user의 local 컴퓨터에서 진행합니다.</p>
<p><a href="https://docs.conda.io/en/latest/miniconda.html">miniconda</a>를 설치한 다음, local 컴퓨터의 터미널에서 아래 커맨드로 virtual environment를 설정합니다. <code>testEnv</code> 자리에 원하는 이름을 넣고, <code>python=</code> 뒤에 사용할 Python version을 명시합니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">conda create -n testEnv <span class="nv">python</span><span class="o">=</span>3.6
</code></pre></td></tr></table>
</div>
</div><p>성공적으로 생성되면 아래와 같은 결과가 나옵니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1"> 1</a>
</span><span class="lnt" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2"> 2</a>
</span><span class="lnt" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3"> 3</a>
</span><span class="lnt" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4"> 4</a>
</span><span class="lnt" id="5"><a style="outline: none; text-decoration:none; color:inherit" href="#5"> 5</a>
</span><span class="lnt" id="6"><a style="outline: none; text-decoration:none; color:inherit" href="#6"> 6</a>
</span><span class="lnt" id="7"><a style="outline: none; text-decoration:none; color:inherit" href="#7"> 7</a>
</span><span class="lnt" id="8"><a style="outline: none; text-decoration:none; color:inherit" href="#8"> 8</a>
</span><span class="lnt" id="9"><a style="outline: none; text-decoration:none; color:inherit" href="#9"> 9</a>
</span><span class="lnt" id="10"><a style="outline: none; text-decoration:none; color:inherit" href="#10">10</a>
</span><span class="lnt" id="11"><a style="outline: none; text-decoration:none; color:inherit" href="#11">11</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">Preparing transaction: done
Verifying transaction: done
Executing transaction: done
#
# To activate this environment, use
#
#     $ conda activate testEnv
#
# To deactivate an active environment, use
#
#     $ conda deactivate
</code></pre></td></tr></table>
</div>
</div><p>아래 커맨드를 통해 virtual environment가 제대로 생성되었는지 확인합니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">conda info --env
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span><span class="lnt" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2">2</a>
</span><span class="lnt" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3">3</a>
</span><span class="lnt" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4">4</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"># conda environments:
#
base                  *  /opt/miniconda3
testEnv                  /opt/miniconda3/envs/testEnv
</code></pre></td></tr></table>
</div>
</div><p>Virtual environment에 진입한 뒤 패키지를 설치합니다. pip로 설치되는 패키지들은 conda로 설치된 패키지에 대한 정보를 모르기 때문에 의존성 충돌이 발생할 수 있으므로 conda만을 사용해서 설치하실 것을 권장합니다. <a href="https://anaconda.org/anaconda/scikit-learn">anaconda 웹사이트</a>에서 패키지명을 검색해서 linux-64를 지원하는 버전이 어디까지인지를 확인하고 설치하는 것을 추천합니다. 위 사이트는 설치 커맨드도 제공합니다. 여러 패키지를 설치할 경우 한 커맨드 내에 명시하면 conda가 자동으로 dependency 충돌을 검사해 줍니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span><span class="lnt" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2">2</a>
</span><span class="lnt" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3">3</a>
</span><span class="lnt" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4">4</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">conda activate testEnv

<span class="c1">#For example,</span>
conda install -c conda-forge <span class="nv">lightgbm</span><span class="o">==</span>2.0.7 scikit-learn matplotlib keras
</code></pre></td></tr></table>
</div>
</div><p>또는 user가 사용할 중요한 패키지들이 있을 경우 environment를 생성할 때 사용할 패키지 목록을 지정할 수도 있습니다.
아래 커맨드로 설치된 패키지 목록을 확인합니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">conda list
</code></pre></td></tr></table>
</div>
</div><p>Environment를 지우려면 아래 커맨드를 입력합니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">conda remove --name testEnv --all
</code></pre></td></tr></table>
</div>
</div><h3 id="2-cpu-compute-node에-local과-동일한-conda-environment-구축하기">2. <code>cpu-compute</code> node에 local과 동일한 conda environment 구축하기<a hidden class="anchor" aria-hidden="true" href="#2-cpu-compute-node에-local과-동일한-conda-environment-구축하기">#</a></h3>
<p><strong>conda env export</strong> 커맨드를 이용해 environment 전체를 <code>.yml</code> 파일로 만들고 이를 이용해 <code>cpu-compute</code> 노드에서 environment를 구축하는 것이 동일한 environment를 만드는 가장 이상적인 방법입니다. 또는 설치된 패키지 목록과 버전만을 <code>requirements.txt</code>로 추출하여 노드에서 <code>cpu-compute</code>에서 설치할 수 있습니다. 그러나 이 두 방법은 user의 local 컴퓨터가 linux가 아니면 오류가 발생할 확률이 매우 높습니다. 이는 유저가 패키지를 설치할 때 자동으로 설치되는 dependency들의 버전이 OS별로 다를 수 있기 때문입니다. 예를 들어 <code>lightgbm</code> 2.0.7버전은 Python 버전이 3.6일 때 linux와 MacOS에서 둘 다 설치 가능하지만, 이 패키지의 dependency 중 하나인 <code>libgfortran</code>은 MacOS에서는 4.0.0버전이 설치되지만 linux에서는 3.0.0버전까지만 지원되기 때문에 MacOS에서 만든 environment에서 추출한 yml 파일이나 list txt 파일을 클러스터에서 사용하면 오류가 발생합니다[^fn2]. 이 오류는 적절한 조치를 통해 해결할 수 있을 때도 있지만 해결하기 힘들 때도 있습니다.</p>
<p>따라서 local에서 만든 environment를 cluster로 옮기기보다는, local의 environment에서 사용하는 Python 버전과 중요 패키지들의 버전을 그대로 사용하여 cluster 내에서 environment를 생성하는 것을 추천하며, 이 문서에서는 그 절차를 안내합니다.</p>
<ol>
<li>
<p>Conda environment 생성 batch script를 작성합니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1"> 1</a>
</span><span class="lnt" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2"> 2</a>
</span><span class="lnt" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3"> 3</a>
</span><span class="lnt" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4"> 4</a>
</span><span class="lnt" id="5"><a style="outline: none; text-decoration:none; color:inherit" href="#5"> 5</a>
</span><span class="lnt" id="6"><a style="outline: none; text-decoration:none; color:inherit" href="#6"> 6</a>
</span><span class="lnt" id="7"><a style="outline: none; text-decoration:none; color:inherit" href="#7"> 7</a>
</span><span class="lnt" id="8"><a style="outline: none; text-decoration:none; color:inherit" href="#8"> 8</a>
</span><span class="lnt" id="9"><a style="outline: none; text-decoration:none; color:inherit" href="#9"> 9</a>
</span><span class="lnt" id="10"><a style="outline: none; text-decoration:none; color:inherit" href="#10">10</a>
</span><span class="lnt" id="11"><a style="outline: none; text-decoration:none; color:inherit" href="#11">11</a>
</span><span class="lnt" id="12"><a style="outline: none; text-decoration:none; color:inherit" href="#12">12</a>
</span><span class="lnt" id="13"><a style="outline: none; text-decoration:none; color:inherit" href="#13">13</a>
</span><span class="lnt" id="14"><a style="outline: none; text-decoration:none; color:inherit" href="#14">14</a>
</span><span class="lnt" id="15"><a style="outline: none; text-decoration:none; color:inherit" href="#15">15</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span><span class="c1">#SBATCH --job-name=conda-env-create</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --mem=4gb</span>
<span class="c1">#SBATCH --partition=all</span>
<span class="c1">#SBATCH --nodelist=cpu-compute</span>
<span class="c1">#SBATCH --output=testEnv.out</span>
<span class="c1">#SBATCH --error=testEnv.err</span>
<span class="nv">CONDA_BIN_PATH</span><span class="o">=</span>/opt/miniconda/bin
<span class="nv">ENV_NAME</span><span class="o">=</span>testEnv <span class="c1">#local에서와 같은 이름으로 입력</span>
<span class="nv">ENV_PATH</span><span class="o">=</span>/mnt/nas/users/<span class="k">$(</span>whoami<span class="k">)</span>/.conda/envs/<span class="nv">$ENV_NAME</span>
<span class="nv">$CONDA_BIN_PATH</span>/conda env remove --prefix <span class="nv">$ENV_PATH</span>
<span class="nv">$CONDA_BIN_PATH</span>/conda create -y --prefix <span class="nv">$ENV_PATH</span> <span class="nv">python</span><span class="o">=</span>3.6 
<span class="nb">source</span> <span class="nv">$CONDA_BIN_PATH</span>/activate <span class="nv">$ENV_PATH</span>
conda install -c conda-forge <span class="nv">lightgbm</span><span class="o">==</span>2.0.7 scikit-learn matplotlib keras pandas numpy
</code></pre></td></tr></table>
</div>
</div><p>위 내용에서</p>
<ul>
<li>7번 라인의 <strong>#SBATCH &ndash;output=testEnv.out</strong>의 output log 파일명</li>
<li>8번 라인의 <strong>#SBATCH &ndash;error=testEnv.err</strong>의 error log 파일명</li>
<li>10번 라인의 environment name</li>
<li>13번 라인의 python version</li>
<li>14번 라인의 패키지 설치 커맨드
를 알맞게 수정한 뒤  local에서 <code>testEnv.sh</code>로 저장하여 <code>scp</code>로 클러스터 내 user home directory로 전송합니다. 또는 proxy node에 접속한 뒤 home directory에서</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">vi testEnv.sh
</code></pre></td></tr></table>
</div>
</div><p>를 입력하여 linux의 텍스트 에디터를 실행한 뒤 <code>ctrl+v</code>로 위 내용을 붙여넣기하고 <code>esc</code>, <code>:wq</code>, <code>ENTER</code>를 차례로 눌러 저장합니다.</p>
</li>
<li>
<p>작성한 스크립트 실행하기. proxy node에 SSH접속한 뒤 home directory에서</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">sbatch testEnv.sh
</code></pre></td></tr></table>
</div>
</div><p>를 입력해 slurm batch job submission을 수행합니다. 작업이 노드에서 성공적으로 실행되면</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">Submitted batch job 401
</code></pre></td></tr></table>
</div>
</div><p>와 같은 메시지가 뜨고 job 번호가 할당됩니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">squeue
</code></pre></td></tr></table>
</div>
</div><p>커맨드를 통해 작업 실행 현황을 확인할 수 있습니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span><span class="lnt" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2">2</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">JOBID PARTITION     NAME     USER ST    TIME  NODES NODELIST(REASON)
402     all       conda-en    mjm  R    0:01    1  cpu-compute
</code></pre></td></tr></table>
</div>
</div><p>또는 아래 커맨드를 통해 실시간으로 작업 실행 현황을 확인할 수 있습니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">smap -i <span class="m">1</span>
</code></pre></td></tr></table>
</div>
</div><p>다음 커맨드를 통해 output log, error log파일의 내용을 확인할 수 있습니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">cat testEnv.err
</code></pre></td></tr></table>
</div>
</div><p>error log 또는 output log는 다음 커맨드를 통해 실시간으로 확인할 수 있습니다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">tail -f testEnv.out
</code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h2 id="step-2-make-env-file-and-upload-file-to-users-workspace">Step 2. make env file and upload file to user’s workspace<a hidden class="anchor" aria-hidden="true" href="#step-2-make-env-file-and-upload-file-to-users-workspace">#</a></h2>
<p>local에서 만들어진 env 파일을 서버로 옮길 때는 <strong>scp</strong>를 사용한다. 간단한 사용법은 아래와 같다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span><span class="lnt" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2">2</a>
</span><span class="lnt" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3">3</a>
</span><span class="lnt" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4">4</a>
</span><span class="lnt" id="5"><a style="outline: none; text-decoration:none; color:inherit" href="#5">5</a>
</span><span class="lnt" id="6"><a style="outline: none; text-decoration:none; color:inherit" href="#6">6</a>
</span><span class="lnt" id="7"><a style="outline: none; text-decoration:none; color:inherit" href="#7">7</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># scp 사용법</span>
<span class="c1"># File upload</span>
scp <span class="o">[</span>FILEPATH<span class="o">]</span> ghk@<span class="o">[</span>IP address<span class="o">]</span>:~/ <span class="c1"># upload from local, ~/ means home directory</span>
<span class="c1"># File download</span>
scp ghk@<span class="o">[</span>IP address<span class="o">]</span>:<span class="o">[</span>FILEPATH<span class="o">]</span> ./ <span class="c1"># scp [server file path] [local save path]</span>

<span class="c1"># directory 전체 다운, 업로드 할 때는 -r 옵션을 사용한다.</span>
</code></pre></td></tr></table>
</div>
</div><p>Windows 사용자라면 <strong><a href="https://winscp.net/eng/download.php">WinSCP</a></strong> 라는 이름의 프로그램을 사용하면 local과 서버 간 파일 전송을 보다 쉽게 처리할 수 있다.</p>
<aside>
💡 env file을 이용한 conda 환경 설정은 local과 서버 작업 환경을 동일하게 설정할 수 있는 신뢰할 수 있는 방법이다. 그러나 conda 환경 설정 과정이 너무 번거롭다면 requirements.txt를 만들어 패키지 버전만 관리해도 충돌을 방지할 수 있다.
</aside>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span><span class="lnt" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2">2</a>
</span><span class="lnt" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3">3</a>
</span><span class="lnt" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4">4</a>
</span><span class="lnt" id="5"><a style="outline: none; text-decoration:none; color:inherit" href="#5">5</a>
</span><span class="lnt" id="6"><a style="outline: none; text-decoration:none; color:inherit" href="#6">6</a>
</span><span class="lnt" id="7"><a style="outline: none; text-decoration:none; color:inherit" href="#7">7</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">conda install --force-reinstall -y -q -c conda-forge --file requirements.txt

<span class="c1"># --force-reinstall : Install the package even if it already exists.</span>
<span class="c1"># -y : Yes, do not ask for confirmation.</span>
<span class="c1"># -q : Quiet, do not display progress bar.</span>
<span class="c1"># -c : Channels, additional channels to search for packages</span>
<span class="c1"># conda-forge is recommended</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="step-3-make-slrum-batch-script-and-run-code-in-server">Step 3. make SLRUM batch script and run code in server<a hidden class="anchor" aria-hidden="true" href="#step-3-make-slrum-batch-script-and-run-code-in-server">#</a></h2>
<p>앞선 단계에서 conda환경이 잘 만들어졌다면 해당 가상환경을 activate하여 코드를 돌리는 SLURM batch script를 작성할 수 있다. 사용자들의 이해를 돕기 위해 TensorFlow 공식 페이지에 게시된 <a href="https://www.tensorflow.org/tutorials/quickstart/beginner?hl=ko">초보자용 튜토리얼</a> 코드를 SLURM을 통해 실행시키는 예제를 공유한다. 먼저, 튜토리얼 코드는 다음과 같다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1"> 1</a>
</span><span class="lnt" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2"> 2</a>
</span><span class="lnt" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3"> 3</a>
</span><span class="lnt" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4"> 4</a>
</span><span class="lnt" id="5"><a style="outline: none; text-decoration:none; color:inherit" href="#5"> 5</a>
</span><span class="lnt" id="6"><a style="outline: none; text-decoration:none; color:inherit" href="#6"> 6</a>
</span><span class="lnt" id="7"><a style="outline: none; text-decoration:none; color:inherit" href="#7"> 7</a>
</span><span class="lnt" id="8"><a style="outline: none; text-decoration:none; color:inherit" href="#8"> 8</a>
</span><span class="lnt" id="9"><a style="outline: none; text-decoration:none; color:inherit" href="#9"> 9</a>
</span><span class="lnt" id="10"><a style="outline: none; text-decoration:none; color:inherit" href="#10">10</a>
</span><span class="lnt" id="11"><a style="outline: none; text-decoration:none; color:inherit" href="#11">11</a>
</span><span class="lnt" id="12"><a style="outline: none; text-decoration:none; color:inherit" href="#12">12</a>
</span><span class="lnt" id="13"><a style="outline: none; text-decoration:none; color:inherit" href="#13">13</a>
</span><span class="lnt" id="14"><a style="outline: none; text-decoration:none; color:inherit" href="#14">14</a>
</span><span class="lnt" id="15"><a style="outline: none; text-decoration:none; color:inherit" href="#15">15</a>
</span><span class="lnt" id="16"><a style="outline: none; text-decoration:none; color:inherit" href="#16">16</a>
</span><span class="lnt" id="17"><a style="outline: none; text-decoration:none; color:inherit" href="#17">17</a>
</span><span class="lnt" id="18"><a style="outline: none; text-decoration:none; color:inherit" href="#18">18</a>
</span><span class="lnt" id="19"><a style="outline: none; text-decoration:none; color:inherit" href="#19">19</a>
</span><span class="lnt" id="20"><a style="outline: none; text-decoration:none; color:inherit" href="#20">20</a>
</span><span class="lnt" id="21"><a style="outline: none; text-decoration:none; color:inherit" href="#21">21</a>
</span><span class="lnt" id="22"><a style="outline: none; text-decoration:none; color:inherit" href="#22">22</a>
</span><span class="lnt" id="23"><a style="outline: none; text-decoration:none; color:inherit" href="#23">23</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1"># tensor.py</span>

<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">mnist</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">mnist</span>

<span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="p">(</span><span class="n">x_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span> <span class="o">=</span> <span class="n">mnist</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
<span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span> <span class="o">=</span> <span class="n">x_train</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">,</span> <span class="n">x_test</span> <span class="o">/</span> <span class="mf">255.0</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(</span><span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">),</span>
  <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;softmax&#39;</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span>
              <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;sparse_categorical_crossentropy&#39;</span><span class="p">,</span>
              <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">])</span>

<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span>  <span class="n">y_test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1"> 1</a>
</span><span class="lnt" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2"> 2</a>
</span><span class="lnt" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3"> 3</a>
</span><span class="lnt" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4"> 4</a>
</span><span class="lnt" id="5"><a style="outline: none; text-decoration:none; color:inherit" href="#5"> 5</a>
</span><span class="lnt" id="6"><a style="outline: none; text-decoration:none; color:inherit" href="#6"> 6</a>
</span><span class="lnt" id="7"><a style="outline: none; text-decoration:none; color:inherit" href="#7"> 7</a>
</span><span class="lnt" id="8"><a style="outline: none; text-decoration:none; color:inherit" href="#8"> 8</a>
</span><span class="lnt" id="9"><a style="outline: none; text-decoration:none; color:inherit" href="#9"> 9</a>
</span><span class="lnt" id="10"><a style="outline: none; text-decoration:none; color:inherit" href="#10">10</a>
</span><span class="lnt" id="11"><a style="outline: none; text-decoration:none; color:inherit" href="#11">11</a>
</span><span class="lnt" id="12"><a style="outline: none; text-decoration:none; color:inherit" href="#12">12</a>
</span><span class="lnt" id="13"><a style="outline: none; text-decoration:none; color:inherit" href="#13">13</a>
</span><span class="lnt" id="14"><a style="outline: none; text-decoration:none; color:inherit" href="#14">14</a>
</span><span class="lnt" id="15"><a style="outline: none; text-decoration:none; color:inherit" href="#15">15</a>
</span><span class="lnt" id="16"><a style="outline: none; text-decoration:none; color:inherit" href="#16">16</a>
</span><span class="lnt" id="17"><a style="outline: none; text-decoration:none; color:inherit" href="#17">17</a>
</span><span class="lnt" id="18"><a style="outline: none; text-decoration:none; color:inherit" href="#18">18</a>
</span><span class="lnt" id="19"><a style="outline: none; text-decoration:none; color:inherit" href="#19">19</a>
</span><span class="lnt" id="20"><a style="outline: none; text-decoration:none; color:inherit" href="#20">20</a>
</span><span class="lnt" id="21"><a style="outline: none; text-decoration:none; color:inherit" href="#21">21</a>
</span><span class="lnt" id="22"><a style="outline: none; text-decoration:none; color:inherit" href="#22">22</a>
</span><span class="lnt" id="23"><a style="outline: none; text-decoration:none; color:inherit" href="#23">23</a>
</span><span class="lnt" id="24"><a style="outline: none; text-decoration:none; color:inherit" href="#24">24</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span><span class="c1">#</span>
<span class="c1">#SBATCH --job-name=gpu-tensor-test</span>
<span class="c1">#SBATCH --mem=4gb</span>
<span class="c1">#SBATCH --nodelist=gpu-compute</span>
<span class="c1">#SBATCH --ntasks=1</span>
<span class="c1">#SBATCH --cpus-per-task=1</span>
<span class="c1">#SBATCH --gres=gpu:1</span>
<span class="c1">#SBATCH --time=00:20:00</span>
<span class="c1">#SBATCH --account=ghk</span>
<span class="c1">#SBATCH --partition=all</span>
<span class="c1">#SBATCH --output=/mnt/nas/users/ghk/code/gputest.log</span>

<span class="nv">CONDA_BIN_PATH</span><span class="o">=</span>/opt/miniconda/bin
<span class="nv">ENV_NAME</span><span class="o">=</span>tensor
<span class="nv">ENV_PATH</span><span class="o">=</span>/mnt/nas/users/<span class="k">$(</span>whoami<span class="k">)</span>/.conda/envs/<span class="nv">$ENV_NAME</span>

<span class="c1">## $CONDA_BIN_PATH/conda env remove --prefix $ENV_PATH</span>
<span class="c1">## $CONDA_BIN_PATH/conda create -y --prefix $ENV_PATH python=3.8 tensorflow pandas numpy</span>

<span class="nb">source</span> <span class="nv">$CONDA_BIN_PATH</span>/activate <span class="nv">$ENV_PATH</span>
<span class="c1">## pip uninstall keras</span>
<span class="c1">## pip install keras==2.6.0</span>
python /mnt/nas/users/ghk/code/tensor.py
</code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>—job-name</strong>: 수행할 작업의 이름</li>
<li><strong>—mem</strong>: memory limit</li>
<li><strong>—nodelist</strong>: 작업할 노드의 이름</li>
<li><strong>—ntasks</strong>: 작업의 수</li>
<li><strong>—cpus-per-task</strong>: 각 작업에서 사용할 cpu 코어의 수</li>
<li><strong>—gres=gpu</strong> : 작업에서 사용할 gpu의 개수, gpu-compute 노드에는 총 2개의 gpu가 사용 가능하다.</li>
<li><strong>—time</strong>: 작업 제한시간</li>
<li><strong>—accoun</strong>t: 해당 작업을 수행하는 계정의 이름</li>
<li><strong>—partition</strong>: group of nodes with specific characteristics</li>
<li><strong>—output</strong>: 코드 실행 결과 log</li>
</ul>
<p>제시한 대로 python 파일과 batch script 파일이 잘 만들어졌다면 <strong>sbatch</strong> 명령어를 입력하여 계산을 실행할 수 있다.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1">1</a>
</span><span class="lnt" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2">2</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">sbatch tensor.sh
smap -i <span class="m">1</span> <span class="c1"># 작업 현황을 1초마다 갱신하여 보여준다. ctrl+c로 escape 할 수 있다.</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="1"><a style="outline: none; text-decoration:none; color:inherit" href="#1"> 1</a>
</span><span class="lnt" id="2"><a style="outline: none; text-decoration:none; color:inherit" href="#2"> 2</a>
</span><span class="lnt" id="3"><a style="outline: none; text-decoration:none; color:inherit" href="#3"> 3</a>
</span><span class="lnt" id="4"><a style="outline: none; text-decoration:none; color:inherit" href="#4"> 4</a>
</span><span class="lnt" id="5"><a style="outline: none; text-decoration:none; color:inherit" href="#5"> 5</a>
</span><span class="lnt" id="6"><a style="outline: none; text-decoration:none; color:inherit" href="#6"> 6</a>
</span><span class="lnt" id="7"><a style="outline: none; text-decoration:none; color:inherit" href="#7"> 7</a>
</span><span class="lnt" id="8"><a style="outline: none; text-decoration:none; color:inherit" href="#8"> 8</a>
</span><span class="lnt" id="9"><a style="outline: none; text-decoration:none; color:inherit" href="#9"> 9</a>
</span><span class="lnt" id="10"><a style="outline: none; text-decoration:none; color:inherit" href="#10">10</a>
</span><span class="lnt" id="11"><a style="outline: none; text-decoration:none; color:inherit" href="#11">11</a>
</span><span class="lnt" id="12"><a style="outline: none; text-decoration:none; color:inherit" href="#12">12</a>
</span><span class="lnt" id="13"><a style="outline: none; text-decoration:none; color:inherit" href="#13">13</a>
</span><span class="lnt" id="14"><a style="outline: none; text-decoration:none; color:inherit" href="#14">14</a>
</span><span class="lnt" id="15"><a style="outline: none; text-decoration:none; color:inherit" href="#15">15</a>
</span><span class="lnt" id="16"><a style="outline: none; text-decoration:none; color:inherit" href="#16">16</a>
</span><span class="lnt" id="17"><a style="outline: none; text-decoration:none; color:inherit" href="#17">17</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">ghk@proxy:~/code$ cat gputest.log
2022-03-15 14:27:34.877232: I tensorflow/core/platform/cpu_feature_guard.cc:142<span class="o">]</span> This TensorFlow binary is optimized with oneAPI Deep Neural Network Library <span class="o">(</span>oneDNN<span class="o">)</span> to use the following CPU instructions in performance-critical operations:  SSE4.1 SSE4.2 AVX AVX2 AVX512F FMA
To <span class="nb">enable</span> them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2022-03-15 14:27:34.887611: I tensorflow/core/common_runtime/process_util.cc:146<span class="o">]</span> Creating new thread pool with default inter op setting: 2. Tune using inter_op_parallelism_threads <span class="k">for</span> best performance.
2022-03-15 14:27:38.063857: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:185<span class="o">]</span> None of the MLIR Optimization Passes are enabled <span class="o">(</span>registered 2<span class="o">)</span>
Epoch 1/5
1875/1875 <span class="o">[==============================]</span> - 36s 19ms/step - loss: 0.2993 - accuracy: 0.9140
Epoch 2/5
1875/1875 <span class="o">[==============================]</span> - 18s 10ms/step - loss: 0.1436 - accuracy: 0.9575
Epoch 3/5
1875/1875 <span class="o">[==============================]</span> - 17s 9ms/step - loss: 0.1080 - accuracy: 0.9675
Epoch 4/5
1875/1875 <span class="o">[==============================]</span> - 19s 10ms/step - loss: 0.0866 - accuracy: 0.9739
Epoch 5/5
1875/1875 <span class="o">[==============================]</span> - 52s 28ms/step - loss: 0.0750 - accuracy: 0.9762
313/313 - 4s - loss: 0.0782 - accuracy: 0.9779
<span class="o">[</span>0.078231580555439, 0.9779000282287598<span class="o">]</span>
</code></pre></td></tr></table>
</div>
</div><p>SLURM batch script를 사용자들이 보다 편하게 만들 수 있도록 <a href="https://hpc.stat.yonsei.ac.kr/tools/job-configurator.html">SLURM Job Configurator</a> 를 새롭게 작성하였다. 사용자들은 gpu 옵션을 체크하거나 해제하여 gpu-compute node 사용 여부를 결정할 수 있다. 해당되는 옵션을 체크하고 <strong>Print</strong> 버튼을 누르면 손쉽게 batch script를 작성할 수 있다.</p>
<h2 id="더-알아보기">더 알아보기<a hidden class="anchor" aria-hidden="true" href="#더-알아보기">#</a></h2>
<p><a href="https://ubccr.freshdesk.com/support/solutions/articles/5000688140-submitting-a-slurm-job-script">Submitting a slurm job script</a></p>
<p><a href="https://doc.zih.tu-dresden.de/jobs_and_resources/slurm_examples/">SLRUM Job Examples</a></p>
<p><a href="https://researchcomputing.princeton.edu/support/knowledge-base/tensorflow">TensorFlow on the HPC Clusters</a></p>
<h1 id="refernece">Refernece<a hidden class="anchor" aria-hidden="true" href="#refernece">#</a></h1>


  </div>

  <footer class="post-footer">
<nav class="paginav">
  <a class="prev" href="https://hpc.stat.yonsei.ac.kr/docs/conda_env_export_yml/">
    <span class="title">« Prev Page</span>
    <br>
    <span>How to Use GPU Node for SLURM</span>
  </a>
  <a class="next" href="https://hpc.stat.yonsei.ac.kr/docs/how-to-use-gpu-node-for-slurm/">
    <span class="title">Next Page »</span>
    <br>
    <span>How to Use GPU Node for SLURM</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <p align="center">
        <a href="http://bk21-bigdata.yonsei.ac.kr/bbs/page.php?hid=equipment">
        <img width='70%' src='https://hpc.stat.yonsei.ac.kr/images/logo.svg' alt='Yonsei BK logo'>
        </a>
        <br>
    </p>
    <span>&copy; 2022 <a href="https://hpc.stat.yonsei.ac.kr">Chili Pepper</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
